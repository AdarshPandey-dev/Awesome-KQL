// Hunt CVE's from prior years with exploitable avilable

DeviceTvmSoftwareVulnerabilities
| where CveId contains "CVE-" 
| project DeviceId, DeviceName, OSPlatform, OSVersion, SoftwareVersion, CveId, RecommendedSecurityUpdate, RecommendedSecurityUpdateId
| summarize count(), make_set(DeviceName) by CveId, RecommendedSecurityUpdateId
| join kind = inner DeviceTvmSoftwareVulnerabilitiesKB on CveId 
| where VulnerabilitySeverityLevel == @"High" or VulnerabilitySeverityLevel == @"Critical"
| where IsExploitAvailable != 0
| where PublishedDate <= ago(365d) and count_ > 1
| project CveId, AffectedSoftware, CvssScore, VulnerabilitySeverityLevel, IsExploitAvailable, count_, set_DeviceName, LastModifiedTime, PublishedDate, VulnerabilityDescription, RecommendedSecurityUpdateId
